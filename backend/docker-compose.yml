version: '3.8'

services:
  gateway:
    build:
      context: ./gateway
      dockerfile: Dockerfile
    ports:
      - "8080:8080"
    environment:
      - PORT=8080
      - USER_SERVICE_URL=http://user-service:8081
      - MESSAGE_SERVICE_URL=http://message-service:8082
      - ORDER_SERVICE_URL=http://order-service:3000
    depends_on:
      - user-service
      - order-service
    networks:
      - arena-network
    restart: unless-stopped

  user-service:
    build:
      context: ./user-service
      dockerfile: Dockerfile
    ports:
      - "8081:8081"
    environment:
      - PORT=8081
      - MYSQL_URL=${MYSQL_URL}
      - MYSQL_USERNAME=${MYSQL_USERNAME}
      - MYSQL_PASSWORD=${MYSQL_PASSWORD}
      - ORDER_SERVICE_URL=http://order-service:3000
    networks:
      - arena-network
    restart: unless-stopped

  # Message Service (Spring Boot + WebSocket)
  # message-service:
  #   build:
  #     context: ./message-service
  #     dockerfile: Dockerfile
  #   ports:
  #     - "8082:8082"
  #   environment:
  #     - SPRING_PROFILES_ACTIVE=docker
  #     - MONGODB_URI=${MONGODB_URI}
  #     - MONGODB_DATABASE=${MONGODB_DATABASE}
  #   networks:
  #     - arena-network
  #   restart: unless-stopped

  order-service:
    build:
      context: ./order-service
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - PORT=3000
      - MONGO_URL=${MONGO_URL}
      - PAYOS_CLIENT_ID=${PAYOS_CLIENT_ID}
      - PAYOS_API_KEY=${PAYOS_API_KEY}
      - PAYOS_CHECKSUM_KEY=${PAYOS_CHECKSUM_KEY}
      - USER_SERVICE_URL=http://user-service:8081
      - PORT=${PORT}
      - RETURN_URL=${RETURN_URL}
      - CANCEL_URL=${CANCEL_URL}
    networks:
      - arena-network
    restart: unless-stopped

networks:
  arena-network:
    driver: bridge